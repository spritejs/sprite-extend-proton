<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <style>
    html, body {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
    }
    canvas {
      background: black;
    }
  </style>
</head>
<body>
  <div id="container"></div>
  <script src="/js/proton.js"></script>
  <!-- <script src="https://s0.ssl.qhres.com/!7a576114/spritejs.min.js"></script> -->
  <script src="/js/spritejs.js"></script>
  <script src="/js/sprite-extend-proton.js"></script>
  <script>
  (async function () {
    const {Scene, ProtonRenderer} = spritejs
    const scene = new Scene('#container', {
      viewport: [600, 600],
      resolution: [600, 600],
    })
    const layer = scene.layer('fglayer', {
      handleEvent: false,
      autoRender: false,
      shadowContext: false,
    })

    await scene.preload({id: 'fire', src: 'image/fire.png'})

    function createProton() {
      const proton = new Proton()
      const emitter = new Proton.Emitter()
      emitter.rate = new Proton.Rate(new Proton.Span(5, 13), 0.1)

      emitter.addInitialize(new Proton.Mass(1))
      emitter.addInitialize(new Proton.Body('fire'))
      emitter.addInitialize(new Proton.P(new Proton.CircleZone(300, 500, 10)))
      emitter.addInitialize(new Proton.Life(5, 7))
      emitter.addInitialize(new Proton.V(new Proton.Span(2, 3), new Proton.Span(0, 30, true), 'polar'))

      emitter.addBehaviour(new Proton.Scale(1, 0.2))
      emitter.addBehaviour(new Proton.Alpha(1, 0.2))

      // emitter.addBehaviour(new Proton.Color('#ff0000'))

      emitter.emit()
      proton.addEmitter(emitter)

      layer.context.globalCompositeOperation = 'screen'
      const renderer = new ProtonRenderer(layer)
      // const renderer = new Proton.CanvasRenderer(layer.canvas)
      proton.addRenderer(renderer)
      return proton
    }
  
    const proton = createProton()

    function tick() {
      requestAnimationFrame(tick)
      proton.update()
    }
    tick()
    window.layer = layer
  }())
  </script>
</body>
</html>